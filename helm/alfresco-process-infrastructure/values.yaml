# Default values for chart.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.
# README documentation generated automatically from this file via https://github.com/norwoodj/helm-docs

# global -- for common values see https://github.com/Activiti/activiti-cloud-common-chart/blob/master/charts/common/README.md
global:
  # global.registryPullSecrets -- Configure pull secrets for all deployments
  registryPullSecrets:
    - quay-registry-secret
  gateway:
    # global.gateway.domain -- Set to configure gateway domain template, i.e. {{ .Release.Namespace }}.1.3.4.5.nip.io
    # $ helm upgrade aae . --install --set global.gateway.domain=1.2.3.4.nip.io
    domain: ""
    # global.gateway.host -- Set to configure single host domain name for all services, i.e. "{{ .Release.Namespace }}.{{ template "common.gateway-domain" . }}"
    host: '{{ template "common.gateway-domain" . }}'
    # global.gateway.http -- Set to false enables HTTPS configuration on all urls
    http: "false"
    # global.gateway.tlsacme -- Set to enable automatic TLS for ingress if https is enabled
    tlsacme: "false"
    # global.gateway.annotations -- Configure global annotations for all service ingresses
    annotations: {}
  keycloak:
    # global.keycloak.host -- Configure Keycloak host template, i.e. "{{ .Release.Namespace }}.{{ .Values.global.gateway.domain }}"
    host: '{{ template "common.gateway-host" . }}'
    # global.keycloak.url -- Set full url to configure external Keycloak, https://keycloak.mydomain.com/auth
    url: ""
    # global.keycloak.realm -- Configure Keycloak realm
    realm: alfresco
    # global.keycloak.resource -- Configure Keycloak resource
    resource: alfresco
    # global.keycloak.clientId -- Configure Activiti Keycloak Client Id
    clientId: activiti-keycloak
    # global.keycloak.clientSecret -- Configure Activiti Keycloak Client Secret.
    clientSecret: d2b835b5-efdf-4448-8d55-89eaaca9fc96
  acs:
    # global.acs.enabled -- enable support for ACS
    enabled: false
    # global.acs.host -- host for content services
    host: '{{ template "common.gateway-host" . }}'
    # global.acs.url -- set full url to configure external ACS, https://acs.mydomain.com without /alfresco
    url: ""
    # global.acs.admin -- admin credentials to setup required users/groups/acl on ACS
    admin:
      # global.acs.admin.username -- ACS admin username
      username: ""
      # global.acs.admin.password -- ACS admin password
      password: ""
    activemq:
      # global.acs.activemq.url -- ACS ActiveMQ URL for events
      url: ""
      # global.acs.activemq.username -- ACS ActiveMQ username
      username: ""
      # global.acs.activemq.username -- ACS ActiveMQ password
      password: ""
  hxpr:
    # global.hxpr.enabled -- enable support for HxP Repository
    enabled: false
    # global.hxpr.admin -- admin credentials to manage HxP Repository models
    admin:
      # global.hxpr.admin.clientId -- HxP Repository admin client id
      clientId: ""
      # global.hxpr.admin.clientId -- HxP Repository admin client secret
      clientSecret: ""
  hxp:
    # global.hxp.accountId -- the HxP IAM account id which the HxP Repository belongs to
    accountId: ""
alfresco-identity-service:
  # set to false to disable custom alfresco-identity-service ingress with hostname support
  enabled: true
  rbac:
    create: false
  serviceAccount:
    create: false
  ingress:
    enabled: false
  keycloak:
    keycloak:
      image:
        tag: 1.7.0
    ingress:
      enabled: true
      rules:
        - host: '{{ include "common.keycloak-host" . }}'
          paths:
            - path: /auth
              pathType: Prefix
      tls: []
      annotations:
        kubernetes.io/ingress.class: nginx
        nginx.ingress.kubernetes.io/proxy-buffer-size: 128k
        nginx.ingress.kubernetes.io/affinity: cookie
        nginx.ingress.kubernetes.io/session-cookie-name: identity_affinity_route
        nginx.ingress.kubernetes.io/session-cookie-hash: sha1
        nginx.ingress.kubernetes.io/enable-cors: "false"
    postgresql:
      tls:
        enabled: false
      image:
        tag: 13.3.0
      persistence:
        existingClaim: "" # use default postgresql PVC
  extraEnv: |
    - name: KEYCLOAK_USER
      value: admin
    - name: KEYCLOAK_PASSWORD
      value: admin
    - name: KEYCLOAK_IMPORT
      value: /realm/alfresco-realm.json
    - name: PROXY_ADDRESS_FORWARDING
      value: "true"
  realm:
    alfresco:
      client:
        redirectUris:
          - "*"
        webOrigins:
          - "*"
      extraClients:
        - clientId: activiti
          enabled: true
          redirectUris:
            - "*"
          webOrigins:
            - "*"
          directAccessGrantsEnabled: true
          implicitFlowEnabled: true
        - clientId: storage-service
          enabled: true
          authorizationServicesEnabled: true
          directAccessGrantsEnabled: true
          secret: 08102f0f-025c-4226-8a3e-674343bff231
        - clientId: activiti-keycloak
          enabled: true
          clientAuthenticatorType: client-secret
          secret: d2b835b5-efdf-4448-8d55-89eaaca9fc96
          bearerOnly: false
          standardFlowEnabled: false
          implicitFlowEnabled: false
          directAccessGrantsEnabled: true
          serviceAccountsEnabled: true
          publicClient: false
          protocol: openid-connect
          fullScopeAllowed: true
        - clientId: analytics-playground
          enabled: true
          clientAuthenticatorType: client-secret
          secret: 2181210d-ec04-4bcf-8649-8a5dcb1c6342
          redirectUris:
            - "*"
          webOrigins:
            - "*"
          standardFlowEnabled: true
          implicitFlowEnabled: false
          directAccessGrantsEnabled: false
          serviceAccountsEnabled: false
          publicClient: false
          protocol: openid-connect
          protocolMappers:
            - name: realm roles
              protocol: openid-connect
              protocolMapper: oidc-usermodel-realm-role-mapper
              consentRequired: false
              config:
                access.token.claim: 'true'
                claim.name: role
                jsonType.label: String
                multivalued: 'true'
      extraRealmRoles:
        - name: ACTIVITI_ADMIN
          composites:
            client:
              realm-management:
                - view-users
                - view-clients
        - name: ACTIVITI_DEVOPS
          composites:
            client:
              realm-management:
                - view-users
                - view-clients
        - name: ACTIVITI_USER
          composites:
            client:
              realm-management:
                - view-users
                - view-clients
        - name: ACTIVITI_MODELER
          composites:
            client:
              realm-management:
                - view-users
                - view-clients
        - name: ACTIVITI_IDENTITY
          description: "user is able to see the identity section"
          composites:
            client:
              realm-management:
                - view-users
                - view-clients
                - query-realms
                - query-clients
                - manage-users
                - manage-authorization
                - manage-realm
                - manage-clients
        - name: ACTIVITI_ANALYTICS
          description: "user is able to use analytics graphql api"
          composites:
            client:
              realm-management:
                - view-users
                - view-clients
      extraGroups:
        - name: hr
          realmRoles:
            - ACTIVITI_USER
        - name: sales
          realmRoles:
            - ACTIVITI_USER
        - name: testgroup
        - name: processadmin
          realmRoles:
            - ACTIVITI_ADMIN
        - name: processanalytics
          realmRoles:
            - ACTIVITI_ANALYTICS
      extraUsers:
        - username: superadminuser
          enabled: true
          firstName: "Super Admin"
          lastName: "User"
          email: superadminuser@example.com
          credentials:
            - type: password
              value: password
          realmRoles:
            - ACTIVITI_USER
            - ACTIVITI_IDENTITY
            - ACTIVITI_DEVOPS
            - ACTIVITI_ADMIN
            - ACTIVITI_MODELER
            - ACTIVITI_ANALYTICS
            - offline_access
            - uma_authorization
          clientRoles:
            realm-management:
              - manage-users
              - manage-clients
              - manage-authorization
              - manage-events
              - manage-realm
              - create-client
              - impersonation
              - realm-admin
            broker:
              - read-token
            account:
              - manage-account
              - view-profile
        - username: devopsuser
          enabled: true
          firstName: DevOps
          lastName: User
          email: devopsuser@example.com
          credentials:
            - type: password
              value: password
          realmRoles:
            - offline_access
            - uma_authorization
            - ACTIVITI_DEVOPS
          clientRoles:
            account:
              - manage-account
              - view-profile
        - username: hruser
          enabled: true
          firstName: HR
          lastName: User
          email: hruser@example.com
          credentials:
            - type: password
              value: password
          realmRoles:
            - offline_access
            - uma_authorization
            - ACTIVITI_USER
          clientRoles:
            account:
              - manage-account
              - view-profile
          groups:
            - /hr
        - username: processadminuser
          enabled: true
          firstName: "Process Admin"
          lastName: User
          email: processadminuser@example.com
          credentials:
            - type: password
              value: password
          realmRoles:
            - offline_access
            - uma_authorization
            - ACTIVITI_ADMIN
          clientRoles:
            account:
              - manage-account
              - view-profile
          groups:
            - /processadmin
        - username: processanalyticsuser
          enabled: true
          firstName: Process Analytics
          lastName: User
          email: processanalyticsuser@example.com
          credentials:
            - type: password
              value: password
          realmRoles:
            - offline_access
            - uma_authorization
            - ACTIVITI_ANALYTICS
          clientRoles:
            account:
              - manage-account
              - view-profile
          groups:
            - /processanalytics
        - username: salesuser
          enabled: true
          firstName: Sales
          lastName: User
          email: salesuser@example.com
          credentials:
            - type: password
              value: password
          realmRoles:
            - offline_access
            - uma_authorization
            - ACTIVITI_USER
          clientRoles:
            account:
              - manage-account
              - view-profile
          groups:
            - /sales
        - username: testuser
          enabled: true
          firstName: Test
          lastName: User
          email: testuser@example.com
          credentials:
            - type: password
              value: password
          realmRoles:
            - offline_access
            - uma_authorization
            - ACTIVITI_USER
          clientRoles:
            account:
              - manage-account
              - view-profile
          groups:
            - /testgroup
        - username: testadmin
          enabled: true
          firstName: Test
          lastName: Admin
          email: testadmin@example.com
          credentials:
            - type: password
              value: password
          realmRoles:
            - offline_access
            - uma_authorization
            - ACTIVITI_USER
            - ACTIVITI_ADMIN
          clientRoles:
            account:
              - manage-account
              - view-profile
          groups:
            - /testgroup
        - username: identityuser
          enabled: true
          firstName: Identity
          lastName: Admin
          email: identityuser@example.com
          credentials:
            - type: password
              value: password
          realmRoles:
            - offline_access
            - uma_authorization
            - ACTIVITI_IDENTITY
          clientRoles:
            account:
              - manage-account
              - view-profile
        - username: modeler
          enabled: true
          firstName: Modeler
          lastName: User
          email: modeler@example.com
          credentials:
            - type: password
              value: password
          realmRoles:
            - offline_access
            - uma_authorization
            - ACTIVITI_MODELER
          clientRoles:
            account:
              - manage-account
              - view-profile
        - username: modeler-qa
          enabled: true
          firstName: Modeler
          lastName: User
          email: modeler-qa@example.com
          credentials:
            - type: password
              value: password
          realmRoles:
            - offline_access
            - uma_authorization
            - ACTIVITI_MODELER
          clientRoles:
            account:
              - manage-account
              - view-profile
        - username: service-account-activiti-keycloak
          enabled: true
          serviceAccountClientId: activiti-keycloak
          clientRoles:
            realm-management:
              - query-realms
              - view-users
postgresql:
  enabled: true
  image:
    tag: 13.3.0
  postgresqlUsername: alfresco
  postgresqlPassword: alfresco
  postgresqlDatabase: postgres
  postgresqlDataDir: /data/pgdata
  persistence:
    mountPath: /data
  postgresqlExtendedConf:
    max_connections: 300
    log_min_messages: LOG
  resources:
    requests:
      memory: 1500Mi
    limits:
      memory: 1500Mi
  commonAnnotations:
    application: activiti
alfresco-modeling-service:
  enabled: true
  nameOverride: alfresco-modeling-service
  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/rewrite-target: /$1
    path: ""
    subPaths:
      - /modeling-service/?(.*)
      - /dmn-service/?(.*)
      - /script-service/?(.*)
  image:
    repository: quay.io/alfresco/alfresco-modeling-service
    tag: 7.11.0-alpha.48
    pullPolicy: Always
  liquibase:
    enabled: true
  postgresql:
    enabled: true
  db:
    uri: "jdbc:postgresql://{{ .Release.Name }}-{{ .Values.postgresql.name }}:{{ .Values.postgresql.port }}/postgres"
    username: alfresco
    password: alfresco
  probePath: /actuator/health
  rabbitmq:
    enabled: false
  content:
    service:
      path: alfresco
    client:
      id: ""
      secret: ""
  activiti:
    keycloak:
      # alfresco-modeling-service.applications.activiti.keycloak.clientId -- activiti keycloak client id
      clientId: "{{ .Values.global.keycloak.clientId }}"
      # alfresco-modeling-service.applications.activiti.keycloak.clientSecret -- activiti keycloak client secret
      clientSecret: "{{ .Values.global.keycloak.clientSecret }}"
  exampleProjects:
    endpoint: https://alfresco.github.io/apa-templates
    resource: index_7.4.0.json
  extraEnv: |-
    - name: SERVER_PORT
      value: "8080"
    - name: SERVER_USEFORWARDHEADERS
      value: "true"
    - name: SERVER_TOMCAT_INTERNALPROXIES
      value: ".*"
    - name: MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE
      value: "*"
    - name: CONTENT_CLIENT_ID
      value: "{{ .Values.content.client.id }}"
    - name: CONTENT_CLIENT_SECRET
      value: "{{ .Values.content.client.secret }}"
    - name: CONTENT_SERVICE_URL
    {{- if .Values.global.hxpr.enabled}}
      value: "{{ .Values.global.hxpr.url }}"
    {{- else }}
      value: '{{ template "alfresco-process-infrastructure.acs-url" . }}'
    {{- end }}
    - name: CONTENT_SERVICE_PATH
      value: "{{ .Values.content.service.path }}"
    - name: CONTENT_SERVICE_ENABLED
      value: "{{ or .Values.global.acs.enabled .Values.global.hxpr.enabled }}"
    {{- if .Values.global.hxpr.enabled }}
    - name: CONTENT_REPOSITORY_TYPE
      value: "hxp"
    {{- end }}
    {{- with .Values.activiti.keycloak.clientId }}
    - name: ACTIVITI_KEYCLOAK_CLIENT_ID
      value: "{{ tpl . $ }}"
    {{- end }}
    {{- with .Values.activiti.keycloak.clientSecret }}
    - name: ACTIVITI_KEYCLOAK_CLIENT_SECRET
      value: "{{ tpl . $ }}"
    {{- end }}
    - name: ACT_ALFRESCO_MODELING_TEMPLATES_ENDPOINT
      value: "{{ .Values.exampleProjects.endpoint }}"
    - name: ACT_ALFRESCO_MODELING_TEMPLATES_RESOURCE
      value: "{{ .Values.exampleProjects.resource }}"
    {{- if .Values.global.hxpr.enabled }}
    {{- end }}
  javaOpts:
    xms: 512m
    xmx: 1024m
    other: >-
      -XX:+UnlockExperimentalVMOptions -Dsun.zip.disableMemoryMapping=true -XX:+UseParallelGC -XX:MinHeapFreeRatio=5 -XX:GCTimeRatio=4 -XX:AdaptiveSizePolicyWeight=90
  resources:
    limits:
      cpu: 2500m
      memory: 2000Mi
    requests:
      cpu: 1000m
      memory: 1000Mi
alfresco-modeling-app:
  enabled: true
  nameOverride: alfresco-modeling-app
  image:
    repository: quay.io/alfresco/alfresco-modeling-app
    tag: develop
    pullPolicy: Always
  service:
    name: modeling-app
    envType: frontend
  exampleProjects:
    disabled: false
    host: https://alfresco.github.io/apa-templates
    resource: index_7.4.0.json
  env:
    APP_CONFIG_AUTH_TYPE: OAUTH
    APP_CONFIG_ECM_HOST: '{{ template "alfresco-process-infrastructure.acs-url" . }}'
    APP_CONFIG_BPM_HOST: '{{ include "common.gateway-url" . }}'
    APP_CONFIG_IDENTITY_HOST: '{{ include "common.keycloak-url" . }}/admin/realms/{{ include "common.keycloak-realm" . }}'
    APP_CONFIG_DISABLED_EXAMPLE_PROJECTS: "{{ .Values.exampleProjects.disabled }}"
    APP_CONFIG_EXAMPLE_PROJECTS_HOST: "{{ .Values.exampleProjects.host }}"
    APP_CONFIG_EXAMPLE_PROJECTS_RESOURCE: "{{ .Values.exampleProjects.resource }}"
  ingress:
    path: /modeling
    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/enable-cors: "true"
      nginx.ingress.kubernetes.io/cors-allow-headers: Authorization, Content-Type, Accept
  resources:
    limits:
      cpu: 500m
      memory: 1024Mi
    requests:
      cpu: 200m
      memory: 256Mi
alfresco-deployment-service:
  nameOverride: alfresco-deployment-service
  enabled: true
  rabbitmq:
    enabled: false
  image:
    repository: quay.io/alfresco/alfresco-deployment-service
    tag: 7.11.0-alpha.52
    pullPolicy: Always
  postgresql:
    enabled: true
  db:
    # use the namespace qualified postgres hostname for apps deployed in different namespaces
    uri: "jdbc:postgresql://{{ .Release.Name }}-{{ .Values.postgresql.name }}.{{ .Release.Namespace }}:{{ .Values.postgresql.port }}/postgres"
    username: alfresco
    password: alfresco
  applications:
    image:
      # alfresco-deployment-service.applications.image.tag -- default tag for all application images
      tag: develop
      # alfresco-deployment-service.applications.image.pullPolicy -- default pull policy for all application images
      pullPolicy: Always
      # alfresco-deployment-service.applications.image.pullSecretName -- pull secret name for all application images
      pullSecretName: quay-registry-secret
    maxNumber: 20
    # alfresco-deployment-service.applications.maxNumber -- maximum number of application can be deployed
    # @default -- 20 applications can be deployed by default
    database:
      external: true
    connectors:
      # alfresco-deployment-service.applications.connectors.emailConnector -- In order to apply default account configuration to the email connector, all the variables need to be set. All email connectors in every application in the cluster will share the same account.
      emailConnector:
        # alfresco-deployment-service.applications.connectors.emailConnector.username -- email username
        username: ""
        # alfresco-deployment-service.applications.connectors.emailConnector.password -- email password
        password: ""
        # alfresco-deployment-service.applications.connectors.emailConnector.host -- email host
        host: ""
        # alfresco-deployment-service.applications.connectors.emailConnector.port -- email port
        port: ""
    processStorageService:
      # alfresco-deployment-service.applications.processStorageService.clientSecret -- client secret for process storage
      clientSecret: 08102f0f-025c-4226-8a3e-674343bff231
    activiti:
      keycloak:
        # alfresco-deployment-service.applications.activiti.keycloak.clientId -- activiti keycloak client id
        clientId: "{{ .Values.global.keycloak.clientId }}"
        # alfresco-deployment-service.applications.activiti.keycloak.clientSecret -- activiti keycloak client secret
        clientSecret: "{{ .Values.global.keycloak.clientSecret }}"
    analytics:
      metrics:
        export:
          enabled: true
          url: 'http://opensearch-cluster-master.{{ .Release.Namespace }}.svc.cluster.local:9200'
          username: admin
          password: admin
    rabbitmq:
      # alfresco-deployment-service.applications.rabbitmq.host -- RabbitMQ host
      host: "{{ .Release.Name }}-rabbitmq.{{ .Release.Namespace }}"
      # alfresco-deployment-service.applications.rabbitmq.port -- RabbitMQ port
      port: ""
      ssl:
        # alfresco-deployment-service.applications.rabbitmq.ssl.enabled -- RabbitMQ SSL enabled
        enabled: ""
      # alfresco-deployment-service.applications.rabbitmq.username -- RabbitMQ username
      username: "user"
      # alfresco-deployment-service.applications.rabbitmq.password -- RabbitMQ password
      password: "CHANGEME"
      admin:
        # alfresco-deployment-service.applications.rabbitmq.admin.url -- RabbitMQ admin URL, derived from host if not set
        url: ""
    # alfresco-deployment-service.applications.customRedirectUris -- custom URIs to allow for local development
    customRedirectUris: ""
  ingress:
    path: /deployment-service
    enabled: true
    annotations:
      kubernetes.io/ingress.class: nginx
  readinessProbe:
    path: '{{ .Values.ingress.path }}/actuator/health/readiness'
  livenessProbe:
    path: '{{ .Values.ingress.path }}/actuator/health/liveness'
  environment:
    # alfresco-deployment-service.environment.apiUrl -- kubernetes API URL, $ kubectl config view -o jsonpath='{.clusters[0].cluster.server}'
    apiUrl: ""
    # alfresco-deployment-service.environment.apiToken -- kubernetes API Token
    # Create a service account alfresco-deployment-service and retrieve its token:
    # $ kubectl create serviceaccount -n kube-system alfresco-deployment-service
    # $ kubectl create clusterrolebinding alfresco-deployment-service-admin-binding --clusterrole cluster-admin --serviceaccount=kube-system:alfresco-deployment-service
    # $ kubectl -n kube-system get secret $(kubectl -n kube-system get serviceaccount alfresco-deployment-service -o jsonpath='{.secrets[0].name}') -o jsonpath='{.data.token}' | base64 --decode
    apiToken: ""
    # alfresco-deployment-service.environment.namespace -- namespace to copy secrets from to application namespaces
    # @default -- installation namespace
    namespace: "{{ .Release.Namespace }}"
  projectReleaseVolume:
    # alfresco-deployment-service.projectReleaseVolume.storageClass -- storage class for project release volume, set to null spring expression to use default
    storageClass: "#{null}"
    # alfresco-deployment-service.projectReleaseVolume.permission -- permission for project release volume
    permission: ReadWriteMany
  extraVolumes: |-
    - name: config
      configMap:
        name: {{ .Release.Name }}-deployment-config
        defaultMode: 0744
  extraEnv: |-
    - name: SERVER_PORT
      value: "8080"
    - name: SERVER_SERVLET_CONTEXTPATH
      value: "{{ .Values.ingress.path }}"
    - name: SERVER_USEFORWARDHEADERS
      value: "true"
    - name: SERVER_TOMCAT_INTERNALPROXIES
      value: ".*"
    - name: MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE
      value: "*"
    - name: KEYCLOAK_AUTH_SERVER_URL
      value: '{{ include "common.keycloak-url" . }}'
    - name: DOCKER_REGISTRY_IMAGE_TAG
      value: "{{ .Values.applications.image.tag }}"
    - name: ALFRESCO_DOCKER_REGISTRY_SECRET_NAME
      value: "{{ .Values.applications.image.pullSecretName }}"
    - name: ALFRESCO_DOCKER_REGISTRY_IMAGEPULLPOLICY
      value: "{{ .Values.applications.image.pullPolicy }}"
    - name: CONTENT_SERVICE_BASE_URL
    {{- if .Values.global.hxpr.enabled}}
      value: "{{ .Values.global.hxpr.url }}"
    {{- else }}
      value: '{{ template "alfresco-process-infrastructure.acs-url" . }}'
    {{- end }}
    - name: CONTENT_SERVICE_ENABLED
      value: "{{ or .Values.global.acs.enabled .Values.global.hxpr.enabled }}"
    {{- with .Values.global.acs.activemq.url }}
    - name: CONTENT_SERVICE_ACTIVEMQ_URL
      value: "{{ . }}"
    {{- end }}
    {{- with .Values.global.acs.activemq.username }}
    - name: CONTENT_SERVICE_ACTIVEMQ_USERNAME
      value: "{{ . }}"
    {{- end }}
    {{- with .Values.global.acs.activemq.password }}
    - name: CONTENT_SERVICE_ACTIVEMQ_PASSWORD
      value: "{{ . }}"
    {{- end }}
    - name: MODELING_URL
      value: '{{ include "common.gateway-url" . }}/modeling-service'
    - name: ENVIRONMENT_HOST_URL
      value: '{{ include "common.gateway-url" . }}'
    - name: ENVIRONMENT_API_URL
      value: "{{ .Values.environment.apiUrl }}"
    - name: ENVIRONMENT_API_TOKEN
      value: "{{ .Values.environment.apiToken }}"
    - name: ENVIRONMENT_NAMESPACE
      value: "{{ tpl .Values.environment.namespace . }}"
    - name: ENVIRONMENT_DOMAIN
      value: '{{ include "common.gateway-domain" . }}'
    - name: PROJECT_RELEASE_VOLUME_STORAGE_CLASS
      value: "{{ .Values.projectReleaseVolume.storageClass }}"
    - name: PROJECT_RELEASE_VOLUME_PERMISSION
      value: "{{ .Values.projectReleaseVolume.permission }}"
    - name: APPLICATIONS_DATABASE_EXTERNAL
      value: "{{ .Values.applications.database.external }}"
    {{- with .Values.applications.connectors.emailConnector.username }}
    - name: CONNECTOR_EMAILCONNECTOR_USERNAME
      value: "{{ . }}"
    {{- end }}
    {{- with .Values.applications.connectors.emailConnector.password }}
    - name: CONNECTOR_EMAILCONNECTOR_PASSWORD
      value: "{{ . }}"
    {{- end }}
    {{- with .Values.applications.connectors.emailConnector.host }}
    - name: CONNECTOR_EMAILCONNECTOR_HOST
      value: "{{ . }}"
    {{- end }}
    {{- with .Values.applications.connectors.emailConnector.port }}
    - name: CONNECTOR_EMAILCONNECTOR_PORT
      value: "{{ . }}"
    {{- end }}
    {{- with .Values.applications.maxNumber }}
    - name: APPLICATIONS_MAXNUMBER
      value: "{{ . }}"
    {{- end }}
    {{- with .Values.applications.customRedirectUris }}
    - name: CUSTOM_REDIRECT_URIS
      value: "{{ . }}"
    {{- end }}
    - name: PROCESS_STORAGE_SERVICE_CLIENTSECRET
    {{- if .Values.global.hxpr.enabled}}
      value: "{{ .Values.global.hxpr.admin.clientSecret }}"
    {{- else }}
      value: "{{ tpl .Values.applications.processStorageService.clientSecret . }}"
    {{- end }}
    {{- with .Values.applications.activiti.keycloak.clientId }}
    - name: ACTIVITI_KEYCLOAK_CLIENT_ID
      value: "{{ tpl . $ }}"
    {{- end }}
    {{- with .Values.applications.activiti.keycloak.clientSecret }}
    - name: ACTIVITI_KEYCLOAK_CLIENT_SECRET
      value: "{{ tpl . $ }}"
    {{- end }}
    {{- if .Values.applications.rabbitmq.port }}
    - name: APPLICATIONS_RABBITMQ_PORT
      value: "{{ tpl .Values.applications.rabbitmq.port . }}"
    {{- end }}
    {{- if .Values.applications.rabbitmq.host }}
    - name: APPLICATIONS_RABBITMQ_HOST
      value: "{{ tpl .Values.applications.rabbitmq.host . }}"
    {{- end }}
    {{- if .Values.applications.rabbitmq.ssl.enabled}}
    - name: APPLICATIONS_RABBITMQ_SSL_ENABLED
      value: "{{ tpl .Values.applications.rabbitmq.ssl.enabled . }}"
    {{- end }}
    {{- with .Values.applications.rabbitmq.username }}
    - name: APPLICATIONS_RABBITMQ_USERNAME
      value: "{{ . }}"
    {{- end }}
    {{- with .Values.applications.rabbitmq.password }}
    - name: APPLICATIONS_RABBITMQ_PASSWORD
      value: "{{ . }}"
    {{- end }}
    {{- if .Values.applications.rabbitmq.admin.url }}
    - name: APPLICATIONS_RABBITMQ_ADMIN_URL
      value: "{{ tpl .Values.applications.rabbitmq.admin.url . }}"
    {{- end }}
    - name: APPLICATIONS_ANALYTICS_METRICS_EXPORT_ENABLED
      value: "{{ .Values.applications.analytics.metrics.export.enabled }}"
    {{- if .Values.applications.analytics.metrics.export.enabled }}
    - name: APPLICATIONS_ANALYTICS_METRICS_EXPORT_URL
      value: "{{ tpl .Values.applications.analytics.metrics.export.url $ }}"
    - name: APPLICATIONS_ANALYTICS_METRICS_EXPORT_USERNAME
      value: "{{ tpl .Values.applications.analytics.metrics.export.username $ }}"
    - name: APPLICATIONS_ANALYTICS_METRICS_EXPORT_PASSWORD
      value: "{{ tpl .Values.applications.analytics.metrics.export.password $ }}"
    {{- end }}
    - name: ATS_TRANSFORMER_TIKA_URL
      value: "http://tika.{{ .Release.Namespace }}/transform"
    - name: PROCESS_UI_URL
      value: '{{ include "common.gateway-url" . }}'
    {{- if .Values.global.hxpr.enabled }}
    - name: CONTENT_REPOSITORY_TYPE
      value: "hxp"
    - name: PROCESS_STORAGE_SERVICE_CLIENTID
      value: "{{ .Values.global.hxpr.admin.clientId }}"
    - name: HXPIDP_ACCOUNTID
      value: "{{ .Values.global.hxp.accountId }}"
    - name: HXP_CONTEXT_ENVIRONMENT
      value: "{{ .Values.global.hxp.context.environment }}"
    {{- end }}
  javaOpts:
    xms: 256m
    xmx: 512m
    other: >-
      -XX:+UnlockExperimentalVMOptions -Dsun.zip.disableMemoryMapping=true -XX:+UseParallelGC -XX:MinHeapFreeRatio=5 -XX:GCTimeRatio=4 -XX:AdaptiveSizePolicyWeight=90
  resources:
    limits:
      cpu: 1000m
      memory: 1000Mi
    requests:
      cpu: 300m
      memory: 500Mi
alfresco-admin-app:
  enabled: true
  nameOverride: alfresco-admin-app
  image:
    repository: quay.io/alfresco/alfresco-admin-app
    tag: develop
    pullPolicy: Always
  service:
    name: admin-app
    envType: frontend
  applications:
    allowCustomResources: true
  env:
    APP_CONFIG_BPM_HOST: '{{ include "common.gateway-url" . }}'
    APP_CONFIG_AUTH_TYPE: "OAUTH"
    APP_CONFIG_IDENTITY_HOST: '{{ include "common.keycloak-url" . }}/admin/realms/{{ include "common.keycloak-realm" . }}'
  extraEnv: |-
    - name: APP_ALLOW_CUSTOM_RESOURCES
      value: "{{ .Values.applications.allowCustomResources }}"
    {{- if .Values.global.acs.enabled }}
    - name: APP_CONFIG_ECM_HOST
      value: '{{ template "alfresco-process-infrastructure.acs-url" . }}'
    {{- else }}
    - name: APP_CONFIG_PROVIDER
      value: BPM
    {{- end }}
  ingress:
    path: /admin
    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/enable-cors: "true"
      nginx.ingress.kubernetes.io/cors-allow-headers: Authorization, Content-Type, Accept
  resources:
    limits:
      cpu: 500m
      memory: 1024Mi
    requests:
      cpu: 200m
      memory: 256Mi
rabbitmq:
  enabled: true
  extraPlugins: ""
  livenessProbe:
    enabled: false
  customLivenessProbe:
    exec:
      command:
        - rabbitmq-diagnostics
        - status
    initialDelaySeconds: 60
    timeoutSeconds: 15
    periodSeconds: 60
  readinessProbe:
    enabled: false
  customReadinessProbe:
    exec:
      command:
        - rabbitmq-diagnostics
        - ping
    initialDelaySeconds: 20
    periodSeconds: 60
  persistence:
    storageClass:
    accessMode: ReadWriteOnce
  auth:
    username: user
    password: CHANGEME
    erlangCookie: ylY79lOdNUWsJEwAGdVQnhjSazV4QZKO=
  resources:
    requests:
      memory: 1500Mi
    limits:
      memory: 1500Mi
setup-acs-script-job:
  enabled: true
  loadTestData: true
  image:
    repository: bitnami/minideb-extras
    tag: stretch
alfresco-tika-service:
  nameOverride: alfresco-tika-service
  enabled: true
  image:
    repository: alfresco/alfresco-tika
    tag: 2.5.7
  service:
    name: tika
    internalPort: 8090
  ingress:
    enabled: false
  readinessProbe:
    path: /ready
  livenessProbe:
    path: /live
  resources:
    requests:
      memory: 1000Mi
    limits:
      memory: 1000Mi
  javaOpts:
    other: >-
      -XX:MinRAMPercentage=50 -XX:MaxRAMPercentage=80
alfresco-process-analytics-service:
  enabled: true
  nameOverride: alfresco-process-analytics-service
  metrics:
    client:
      url: 'http://opensearch-cluster-master.{{ .Release.Namespace }}.svc.cluster.local:9200'
      username: admin
      password: admin
  graphql:
    service:
      jwtIssuerUri: '{{ include "common.keycloak-url" . }}/realms/{{ include "common.keycloak-realm" . }}'
  image:
    repository: quay.io/alfresco/alfresco-process-analytics-graphql-service
    tag: 7.11.0-alpha.40
    pullPolicy: Always
  service:
    name: alfresco-process-analytics-service
    internalPort: 8080
  env:
    SPRING_WEBFLUX_BASE_PATH: '{{ tpl .Values.ingress.path $ | trimSuffix "/" }}'
    SPRING_ZIPKIN_ENABLED: "false"
    ALFRESCO_PROCESS_ANALYTICS_METRICS_CLIENT_URL: '{{ tpl .Values.metrics.client.url $ }}'
    ALFRESCO_PROCESS_ANALYTICS_METRICS_CLIENT_USERNAME: '{{ tpl .Values.metrics.client.username $ }}'
    ALFRESCO_PROCESS_ANALYTICS_METRICS_CLIENT_PASSWORD: '{{ tpl .Values.metrics.client.password $ }}'
    ALFRESCO_PROCESS_ANALYTICS_GRAPHQL_SERVICE_JWT_ISSUER_URI: '{{ tpl .Values.graphql.service.jwtIssuerUri $ }}'
  ingress:
    enabled: true
    path: /analytics
    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/enable-cors: "true"
  resources:
    limits:
      cpu: 1000m
      memory: 1024Mi
    requests:
      cpu: 200m
      memory: 512Mi
  probePath: '{{ tpl .Values.ingress.path $ | trimSuffix "/" }}/actuator/health'
alfresco-process-analytics-playground:
  enabled: true
  nameOverride: alfresco-process-analytics-playground
  graphql:
    client:
      oauth2ClientId: analytics-playground
      oauth2ClientSecret: 2181210d-ec04-4bcf-8649-8a5dcb1c6342
      jwtIssuerUri: '{{ include "common.keycloak-url" . }}/realms/{{ include "common.keycloak-realm" . }}'
      url: 'http://alfresco-process-analytics-service.{{ .Release.Namespace }}.svc.cluster.local/analytics/graphql'
  image:
    repository: quay.io/alfresco/alfresco-process-analytics-graphql-playground
    tag: 7.11.0-alpha.40
    pullPolicy: Always
  service:
    name: alfresco-process-analytics-playground
    internalPort: 5000
  env:
    SPRING_WEBFLUX_BASE_PATH: '{{ tpl .Values.ingress.path $ | trimSuffix "/" }}'
    SPRING_ZIPKIN_ENABLED: "false"
    ALFRESCO_PROCESS_ANALYTICS_GRAPHQL_CLIENT_URL: '{{ tpl .Values.graphql.client.url $ }}'
    ALFRESCO_PROCESS_ANALYTICS_GRAPHQL_CLIENT_JWT_ISSUER_URI: '{{ tpl .Values.graphql.client.jwtIssuerUri $ }}'
    ALFRESCO_PROCESS_ANALYTICS_GRAPHQL_CLIENT_OAUTH2_CLIENT_ID: '{{ tpl .Values.graphql.client.oauth2ClientId $ }}'
    ALFRESCO_PROCESS_ANALYTICS_GRAPHQL_CLIENT_OAUTH2_CLIENT_SECRET: '{{ tpl .Values.graphql.client.oauth2ClientSecret $ }}'
  ingress:
    enabled: true
    path: /analytics/playground/
    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/enable-cors: "true"
  resources:
    limits:
      cpu: 1000m
      memory: 1024Mi
    requests:
      cpu: 200m
      memory: 512Mi
  probePath: '{{ tpl .Values.ingress.path $ | trimSuffix "/" }}/actuator/health'
opensearch:
  enabled: true
  replicas: 2
  extraEnvs:
    - name: DISABLE_INSTALL_DEMO_CONFIG
      value: "true"
    - name: DISABLE_SECURITY_PLUGIN
      value: "true"
alfresco-identity-adapter-service:
  enabled: true
  nameOverride: alfresco-identity-adapter-service
  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/rewrite-target: /$1
    path: "/identity-adapter-service/?(.*)"
  image:
    repository: quay.io/alfresco/alfresco-identity-adapter-service
    tag: 7.11.0-alpha.33
    pullPolicy: Always
  liquibase:
    enabled: false
  postgresql:
    enabled: false
  probePath: /actuator/health
  rabbitmq:
    enabled: false
  activiti:
    keycloak:
      # alfresco-modeling-service.applications.activiti.keycloak.clientId -- activiti keycloak client id
      clientId: "{{ .Values.global.keycloak.clientId }}"
      # alfresco-modeling-service.applications.activiti.keycloak.clientSecret -- activiti keycloak client secret
      clientSecret: "{{ .Values.global.keycloak.clientSecret }}"
  extraEnv: |-
    - name: SERVER_PORT
      value: "8080"
    - name: SERVER_USEFORWARDHEADERS
      value: "true"
    - name: SERVER_TOMCAT_INTERNALPROXIES
      value: ".*"
    - name: MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE
      value: "*"
    {{- with .Values.activiti.keycloak.clientId }}
    - name: ACTIVITI_KEYCLOAK_CLIENT_ID
      value: "{{ tpl . $ }}"
    {{- end }}
    {{- with .Values.activiti.keycloak.clientSecret }}
    - name: ACTIVITI_KEYCLOAK_CLIENT_SECRET
      value: "{{ tpl . $ }}"
    {{- end }}
  javaOpts:
    xms: 512m
    xmx: 3072m
    other: >-
      -XX:+UnlockExperimentalVMOptions -Dsun.zip.disableMemoryMapping=true -XX:+UseParallelGC -XX:MinHeapFreeRatio=5 -XX:GCTimeRatio=4 -XX:AdaptiveSizePolicyWeight=90
